# event
workflow "eventtest" [
	in [
		in string;
	]
	out [
		out string;
		event json optional;
	]
	wfomap [[
		$o{out} = $v{thing};
	]]
	do [
		subscribe [[
			$i{name} = "my1stevent";
			$i{mask} = { "foo" => "bar"};
		]]
		raise_event [[ $i{event} = { $a{in} => "bar", "blah" => "blargh" }; ]]
		wait_for_event [
			imap [[ $i{events} = ["my1stevent"] ]]
			omap [[ $v{event} = $o{event} ]]
		]
		if [[ $v{event}->{name} eq "my1stevent" ]] then [
			eval [[ $v{thing} = 'got my1stevent' ]]
		] else [
			eval [[ $v{thing} = 'got something else' ]]
		]
		unsubscribe [[ $i{name} = "my1stevent"; ]]
	]
]
