#!/usr/bin/perl

use Mojo::Base -base;
use Mojo::JSON qw(decode_json encode_json);

# standard modules
use Cwd qw(realpath);
use Data::Dumper;
use FindBin;
use Getopt::Long;

# other
#use Config::Tiny;

# JobCenter
use lib realpath("$FindBin::Bin/../lib");
use JobCenter::MojoClient;

exit main(@ARGV);

sub main {
	if (scalar @_ != 2) {
		die "usage: $0 <wfname> <jsonblob>";
	}

	my ($wfname, $inargs) = @_;

	say "frup";

	# hopefully this checks for valid json..
	my $inargsp = decode_json($inargs);

	my $config = realpath("$FindBin::Bin/../etc/jobcenter.conf");

	my $client = JobCenter::MojoClient->new(
		cfgpath => $config,
		debug => 1,
		json => 1,
	);

	die 'no client?' unless $client;
	say "frop";

	my $outargs;
	local $@;
	eval { $outargs = $client->call(
		wfname => $wfname,
		inargs => $inargs,
	); };
	say "got $@" if $@;

	say "outargs: $outargs";

	say "the end is nigh!";
}

1;




